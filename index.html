<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Balbi Faucet</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <link rel="icon" type="image/png" sizes="3232" href="logo1.png">
  <style>
    :root{
      --bg1:#0a1022; --bg2:#0d1b34;
      --accent:#2b6cb0; --accent2:#63b3ed; --accent3:#8ec7ff;
      --text:#e6eefb; --muted:#a5b4cf; --radius:18px;
      --hexOpacity:.08;
    }
    html,body{height:100%}
    body{
      margin:0; font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,Arial,sans-serif;
      color:var(--text);
      background:
        radial-gradient(1100px 520px at 10% -10%, rgba(43,108,176,.10) 0%, transparent 60%),
        radial-gradient(900px 420px at 110% 120%, rgba(99,179,237,.10) 0%, transparent 62%),
        linear-gradient(180deg,var(--bg1),var(--bg2));
      display:flex; align-items:center; flex-direction:column; gap:16px;
      padding:24px 18px 28px; overflow-x:hidden;
    }

    /* INTRO (abertura) — cobre a página inteira e aparece sozinha */
    .intro{
      position:fixed; inset:0; width:100%; height:100dvh;
      display:grid; place-items:center;
      z-index:10000;
      background: linear-gradient(140deg, var(--bg1), var(--bg2), var(--bg1));
      background-size: 240% 240%;
      animation:
        introFade 1.8s ease forwards,
        bgMove 24s ease-in-out infinite;
    }
    .intro::before{
      content:""; position:absolute; inset:0;
      background: radial-gradient(1200px 700px at 50% -20%, rgba(99,179,237,.12), transparent 70%);
      pointer-events:none;
    }
    @keyframes introFade{ 0%{opacity:1} 85%{opacity:1} 100%{opacity:0; visibility:hidden} }
    @keyframes bgMove{ 0%{background-position:0% 50%} 50%{background-position:100% 50%} 100%{background-position:0% 50%} }

    .intro-wrap{
      width:clamp(160px, 26vmin, 320px);
      aspect-ratio:1/1; position:relative;
      transform: translateY(-16vh);
      animation:introPop .9s cubic-bezier(.2,.8,.2,1) forwards;
    }
    @keyframes introPop{
      0%{opacity:0; transform:translateY(-16vh) scale(.6) rotate(-8deg)}
      60%{opacity:1; transform:translateY(-16vh) scale(1.06)}
      100%{transform:translateY(-16vh) scale(1)}
    }
    .intro svg{width:100%; height:100%}
    .intro .hx-outline{stroke:url(#introStroke); stroke-width:8; fill:none; stroke-linejoin:round; filter:drop-shadow(0 8px 28px rgba(99,179,237,.25))}
    .intro .vertex{fill:url(#introStroke)}
    .intro image{clip-path:url(#introClip)}
    .intro .dash{stroke:#8ec7ff; stroke-width:3; fill:none; stroke-dasharray:20 90; animation:introDash 1.8s linear forwards}
    @keyframes introDash{ to{ stroke-dashoffset:-140 } }

    /* HEX de fundo */
    .hex-drift{position:fixed; inset:0; z-index:0; pointer-events:none; overflow:hidden}
    .hex{position:absolute; width:220px; aspect-ratio:1/1; opacity:var(--hexOpacity)}
    .hex svg{width:100%; height:100%}
    .hex use{stroke:url(#hexStroke); stroke-width:2; fill:none; filter:drop-shadow(0 0 6px rgba(99,179,237,.08))}
    .h1{top:10%; left:-20%; animation:float 28s linear infinite}
    .h2{top:60%; left:80%;  animation:float 32s linear infinite reverse}
    .h3{top:22%; left:45%;  animation:float 36s linear infinite}
    .h4{top:78%; left:-10%; animation:float 30s linear infinite reverse}
    @keyframes float{
      0%{transform:translateX(-10vw) translateY(0) rotate(0deg) scale(.92)}
      50%{transform:translateX(20vw) translateY(-8vh) rotate(180deg) scale(1)}
      100%{transform:translateX(60vw) translateY(4vh) rotate(360deg) scale(.92)}
    }

    .layer{position:relative; z-index:1; width:min(520px,94vw); margin:0 auto}
    .card{
      border-radius:var(--radius);
      background:linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,.02));
      border:1px solid rgba(47,82,152,.35);
      box-shadow:0 16px 44px rgba(8,14,35,.55), inset 0 1px 0 rgba(255,255,255,.05);
      padding:26px 20px 22px;
    }

    .hero{display:grid; place-items:center; gap:10px; margin-bottom:12px}
    .logo-wrap{width:min(150px,54vw,40dvh); aspect-ratio:1/1}
    .logo-wrap svg{width:100%; height:100%}
    .hx-main{stroke:url(#stroke); stroke-width:7; fill:none; stroke-linejoin:round}
    .hx-dash{stroke:#8ec7ff; stroke-width:3; fill:none; stroke-dasharray:22 82; opacity:.9; animation:dash 9s linear infinite}
    @keyframes dash{to{stroke-dashoffset:-104}}
    .vertex{fill:url(#stroke)}
    .title{font-weight:800; font-size:28px; color:#b3d9ff; text-shadow:0 0 10px rgba(99,179,237,.55); margin:0}
    /* Mudança de texto: subtítulo para refletir a nova forma de login */
    .subtitle{color:var(--muted); margin:0 8px 16px; text-align:center}

    /* Inputs */
    #privateKeyInput{
      width:100%; padding:12px; margin:0 0 14px; outline:none; color:#fff;
      background:rgba(255,255,255,.06); border:1px solid rgba(61,106,196,.5);
      box-shadow:inset 0 0 0 1px rgba(255,255,255,.04);
      border-radius:12px; font-size:16px; box-sizing:border-box;
    }
    #privateKeyInput::placeholder{color:#c7d6f0aa}
    #privateKeyInput:focus{border-color:#63b3ed; box-shadow:0 0 0 3px #63b3ed33, inset 0 0 0 1px rgba(255,255,255,.06)}

    #connectButton{
      width:100%; padding:12px; border:none; color:#fff; font-weight:800;
      background:linear-gradient(90deg,#2b6cb0,#63b3ed);
      text-transform:uppercase; letter-spacing:.08em;
      box-shadow:0 10px 22px rgba(43,108,176,.35); position:relative; overflow:hidden;
      border-radius:12px; font-size:16px; box-sizing:border-box; cursor:pointer;
    }
    #connectButton::after{
      content:""; position:absolute; inset:0;
      background:linear-gradient(120deg,transparent 0 32%, rgba(255,255,255,.22) 50%, transparent 70%);
      transform:translateX(-100%); transition:transform .65s ease;
    }
    #connectButton:hover::after{transform:translateX(100%)}

    .wallet-address{
      display:none; margin-top:14px; font-size:14px; color:#cfe4ff; word-break:break-all;
      padding:10px; border-radius:10px; border:1px solid #335aa8cc; background:rgba(255,255,255,.05)
    }
    #logoutButton{
      margin-top:10px; padding:6px 12px; font-size:12px; color:#fff; border:none; border-radius:8px;
      background:linear-gradient(90deg,#ef4444,#f43f5e); cursor:pointer;
    }

    .panel{background:rgba(255,255,255,.05); border-radius:14px; padding:18px; box-shadow:inset 0 0 18px rgba(43,108,176,.12)}
    .panel h2{margin:0 0 10px; font-size:18px; color:#8ec7ff}
    .balance-item{display:flex; justify-content:space-between; padding:8px 0; border-bottom:1px solid #2f529833}
    .balance-item:last-child{border-bottom:0}
    .balance-value{font-weight:800; color:#8ec7ff}

    /* Claim: cinza inativo, verde ativo */
    #claimButton{
      width:100%; margin-top:6px; padding:14px; font-size:18px; border-radius:12px; border:none;
      position:relative; overflow:hidden; box-sizing:border-box;
      background:linear-gradient(90deg,#6b7280,#9ca3af); color:#eee; box-shadow:none;
      cursor:not-allowed; opacity:.95;
    }
    #claimButton[disabled]{
      background:linear-gradient(90deg,#6b7280,#9ca3af);
      color:#eee; box-shadow:none; cursor:not-allowed; opacity:.95; pointer-events:none;
    }
    #claimButton:not([disabled]){
      background:linear-gradient(90deg,#39ff14,#00ffa3);
      color:#000; box-shadow:0 0 20px rgba(57,255,20,.35);
      cursor:pointer;
    }
    #claimButton::before{
      content:""; position:absolute; top:-60%; left:-60%; width:220%; height:220%;
      background:radial-gradient(circle,rgba(255,255,255,.22) 0%, transparent 60%);
      transform:rotate(35deg); animation:shine 3s infinite; pointer-events:none;
    }
    @keyframes shine{0%{transform:translate(-60%,-60%) rotate(35deg)}100%{transform:translate(60%,60%) rotate(35deg)}}

    .claim-timer{color:#8ec7ff; margin-top:10px}
    .claim-success{color:#bfe0ff; margin-top:10px; font-weight:700; display:none}
    .claim-hash{color:#aab3c9; margin-top:8px; font-size:12px; display:none; word-break:break-all}

    .faq{width:min(520px,94vw); margin:34px auto 12px}
    .faq h2{text-align:center; font-size:22px; color:#8ec7ff; text-shadow:0 0 8px rgba(99,179,237,.4); margin-bottom:14px}
    .faq-item{background:rgba(255,255,255,.05); border-radius:12px; padding:16px 18px; color:#dde6ff; margin-bottom:12px}

    .footer{
      width:100%; text-align:center; color:#a9b8d8; font-size:12px;
      margin-top:24px; padding-bottom:72px;
    }
    .links a{color:#8ec7ff; text-decoration:none; margin:0 10px}
    .links a:hover{text-shadow:0 0 8px rgba(142,199,255,.8)}

    #cookieConsent{position:fixed; bottom:0; width:100%; background:rgba(20,20,40,.95); color:#fff; text-align:center; padding:15px 20px; display:none; z-index:1000; box-shadow:0 -2px 10px rgba(0, 136, 255, .3)}
    #acceptCookiesButton{margin-top:10px; padding:8px 16px; border-radius:8px; border:none; background:linear-gradient(90deg,#2b6cb0,#63b3ed); color:#000; font-weight:bold; cursor:pointer;}

    /* LOADING overlay (pós-login) */
    .loading{
      position:fixed; inset:0; width:100%; height:100dvh;
      z-index:9998; display:none; place-items:center;
      backdrop-filter: blur(6px);
      background: radial-gradient(1000px 600px at 50% -10%, rgba(99,179,237,.12), transparent 70%);
      animation:loadingFadeIn .2s ease-out;
    }
    .loading.show{display:grid;}
    @keyframes loadingFadeIn{ from{opacity:0} to{opacity:1} }

    .loading-wrap{
      width:clamp(150px, 22vmin, 260px); aspect-ratio:1/1; position:relative;
      transform:translateY(-7vh);
      animation:loadingPop .45s cubic-bezier(.2,.8,.2,1)
    }
    @media (max-width: 480px){
      .loading-wrap{ transform:translateY(-5vh); }
    }
    @keyframes loadingPop{ from{transform:translateY(-7vh) scale(.92); opacity:.6} to{transform:translateY(-7vh) scale(1); opacity:1} }
    .loading svg{width:100%; height:100%}
    .loading .outline{stroke:url(#loadStroke); stroke-width:7; fill:none; stroke-linejoin:round; filter:drop-shadow(0 8px 20px rgba(99,179,237,.25))}
    .loading .dash{stroke:#8ec7ff; stroke-width:3; fill:none; stroke-dasharray:18 70; animation:loadDash 1.9s linear infinite}
    @keyframes loadDash{ to{ stroke-dashoffset:-120 } }
    .loading .v{fill:url(#loadStroke); animation:pulse 1.9s ease-in-out infinite}
    .loading .v:nth-child(1){animation-delay:0s}
    .loading .v:nth-child(2){animation-delay:.15s}
    .loading .v:nth-child(3){animation-delay:.3s}
    .loading .v:nth-child(4){animation-delay:.45s}
    .loading .v:nth-child(5){animation-delay:.6s}
    .loading .v:nth-child(6){animation-delay:.75s}
    @keyframes pulse{ 0%,100%{transform:scale(1)} 50%{transform:scale(1.18)} }

    /* Neon active state for Quiz Claim button */
    #quizPanel #quizClaimBtn.quiz-claim-active{
      background: linear-gradient(90deg, #22c55e, #86efac);
      color:#052e16; font-weight:800;
      border:none;
      box-shadow: 0 0 16px rgba(34,197,94,.75), 0 0 32px rgba(134,239,172,.45);
      text-shadow: 0 0 6px rgba(255,255,255,.35);
    }

/* v9c: strict removal of scrollbars in quiz modal */
#quizModal {
  overflow: hidden !important;
  max-height: 100vh !important;
  max-width: 100vw !important;
}
#quizModal .quiz-card {
  overflow: visible !important;
  max-height: none !important;
  max-width: 100% !important;
  padding-right: 20px;
  box-sizing: border-box;
}
#quizModal, #quizModal * {
  scrollbar-width: none !important;
}
#quizModal::-webkit-scrollbar,
#quizModal *::-webkit-scrollbar {
  display: none !important;
}
  </style>
</head>
<body>

<div class="intro" id="intro" aria-hidden="true">
  <svg width="0" height="0" aria-hidden="true">
    <defs>
      <linearGradient id="introStroke" x1="0" y1="0" x2="1" y2="1">
        <stop offset="0%" stop-color="#2b6cb0"/><stop offset="100%" stop-color="#63b3ed"/>
      </linearGradient>
      <clipPath id="introClip">
        <path id="introHex" d="M120 36 L193 78 L193 162 L120 204 L47 162 L47 78 Z"/>
      </clipPath>
    </defs>
  </svg>
  <div class="intro-wrap">
    <svg viewBox="0 0 240 240" role="img" aria-label="Balbi hex introduction">
      <use href="#introHex" class="hx-outline"></use>
      <use href="#introHex" class="dash"></use>
      <circle class="vertex" cx="120" cy="36" r="6"/>
      <circle class="vertex" cx="193" cy="78" r="6"/>
      <circle class="vertex" cx="193" cy="162" r="6"/>
      <circle class="vertex" cx="120" cy="204" r="6"/>
      <circle class="vertex" cx="47"  cy="162" r="6"/>
      <circle class="vertex" cx="47"  cy="78"  r="6"/>
      <image href="logo1.png" x="72" y="70" width="96" height="96" preserveAspectRatio="xMidYMid meet" clip-path="url(#introClip)"/>
    </svg>
  </div>
</div>

<div class="loading" id="loadingOverlay" aria-hidden="true">
  <svg width="0" height="0" aria-hidden="true">
    <defs>
      <linearGradient id="loadStroke" x1="0" y1="0" x2="1" y2="1">
        <stop offset="0%" stop-color="#2b6cb0"/><stop offset="100%" stop-color="#63b3ed"/>
      </linearGradient>
      <clipPath id="loadClip">
        <path id="loadHex" d="M120 36 L193 78 L193 162 L120 204 L47 162 L47 78 Z"/>
      </clipPath>
    </defs>
  </svg>
  <div class="loading-wrap">
    <svg viewBox="0 0 240 240" role="img" aria-label="Loading">
      <use href="#loadHex" class="outline"></use>
      <use href="#loadHex" class="dash"></use>
      <circle class="v" cx="120" cy="36" r="6"/>
      <circle class="v" cx="193" cy="78" r="6"/>
      <circle class="v" cx="193" cy="162" r="6"/>
      <circle class="v" cx="120" cy="204" r="6"/>
      <circle class="v" cx="47"  cy="162" r="6"/>
      <circle class="v" cx="47"  cy="78"  r="6"/>
      <image href="logo1.png" x="72" y="70" width="96" height="96" preserveAspectRatio="xMidYMid meet" clip-path="url(#loadClip)"/>
    </svg>
  </div>
</div>

<div class="hex-drift" aria-hidden="true">
  <svg width="0" height="0" aria-hidden="true">
    <defs>
      <linearGradient id="hexStroke" x1="0" y1="0" x2="1" y2="1">
        <stop offset="0%" stop-color="#2b6cb0"/><stop offset="100%" stop-color="#63b3ed"/>
      </linearGradient>
      <symbol id="hexSymbol" viewBox="0 0 200 200">
        <polygon points="100,10 185,55 185,145 100,190 15,145 15,55"
                 fill="none" stroke="url(#hexStroke)" stroke-width="2" stroke-linejoin="round"/>
        <circle cx="100" cy="10"  r="5" fill="url(#hexStroke)"/>
        <circle cx="185" cy="55"  r="5" fill="url(#hexStroke)"/>
        <circle cx="185" cy="145" r="5" fill="url(#hexStroke)"/>
        <circle cx="100" cy="190" r="5" fill="url(#hexStroke)"/>
        <circle cx="15"  cy="145" r="5" fill="url(#hexStroke)"/>
        <circle cx="15"  cy="55"  r="5" fill="url(#hexStroke)"/>
      </symbol>
    </defs>
  </svg>
  <div class="hex h1"><svg viewBox="0 0 200 200"><use href="#hexSymbol"/></svg></div>
  <div class="hex h2"><svg viewBox="0 0 200 200"><use href="#hexSymbol"/></svg></div>
  <div class="hex h3"><svg viewBox="0 0 200 200"><use href="#hexSymbol"/></svg></div>
  <div class="hex h4"><svg viewBox="0 0 200 200"><use href="#hexSymbol"/></svg></div>
</div>

<div class="layer">
  <div class="card">
    <div class="hero">
      <div class="logo-wrap">
        <svg viewBox="0 0 240 240" aria-hidden="true">
          <defs>
            <linearGradient id="stroke" x1="0" y1="0" x2="1" y2="1">
              <stop offset="0%" stop-color="#2b6cb0"/><stop offset="100%" stop-color="#63b3ed"/>
            </linearGradient>
            <clipPath id="clipHex"><path id="hexPath" d="M120 36 L193 78 L193 162 L120 204 L47 162 L47 78 Z"/></clipPath>
          </defs>
          <use href="#hexPath" class="hx-main"></use>
          <use href="#hexPath" class="hx-dash"></use>
          <g>
            <circle class="vertex" cx="120" cy="36" r="6"/>
            <circle class="vertex" cx="193" cy="78" r="6"/>
            <circle class="vertex" cx="193" cy="162" r="6"/>
            <circle class="vertex" cx="120" cy="204" r="6"/>
            <circle class="vertex" cx="47"  cy="162" r="6"/>
            <circle class="vertex" cx="47"  cy="78"  r="6"/>
          </g>
          <image href="logo1.png" x="72" y="70" width="96" height="96" preserveAspectRatio="xMidYMid meet" clip-path="url(#clipHex)"/>
        </svg>
      </div>
      <h1 class="title">Balbi Faucet</h1>
      <p class="subtitle">Connect your wallet to get started with the Balbi Faucet.</p>
    </div>

    <input type="text" autocomplete="username" tabindex="-1" aria-hidden="true" style="position:absolute;left:-9999px;opacity:0;height:0;width:0;border:0;padding:0">
    <input type="password" autocomplete="current-password" tabindex="-1" aria-hidden="true" style="position:absolute;left:-9999px;opacity:0;height:0;width:0;border:0;padding:0">

    <div id="loginSection">
      <button id="connectButton" type="button">Connect Wallet</button>
    </div>

    <div id="walletAddress" class="wallet-address" style="display:none;">
      <span>Wallet Address:</span>
      <div id="addressDisplay"></div>
      <button id="logoutButton" type="button">Log Out</button>
    </div>

    <div id="walletInfo" style="display:none;">
      <div class="panel" style="margin-top:14px;">
        <h2>Faucet</h2>
        <p>Claim Balbi every 4 hours and help the ecosystem grow.</p>
        <button id="claimButton" type="button" disabled>Claim Balbi</button>
        <div id="claimTimer" class="claim-timer"></div>
        <div id="claimSuccess" class="claim-success">Tokens sent successfully!</div>
        <div id="claimHash" class="claim-hash" style="display:none;"></div>
      </div>

      <div class="panel">
        <h2>Balances</h2>
        <p class="tiny-note" style="margin-top:6px;font-size:11px;color:#ccc;opacity:.6">⏳ Note: balance may take a moment to update after a claim.</p>
        <div class="balance-item">
          <span>BALBI Balance</span>
          <span id="balbiBalance" class="balance-value">...</span>
        </div>
        <div class="balance-item">
          <span>USDC Balance</span>
          <span id="usdcBalance"  class="balance-value">...</span>
        </div>
      </div>

      <div class="panel" id="quizPanel" style="margin-top:14px;">
        <h2>Quiz — Play & Earn</h2>
        <p>Up to <strong>3 rounds</strong> per 4-hour window. Each passed round (≥60 pts) adds
           <strong>0.06–0.1 BALBI</strong> to your quiz balance based on score. You can claim the accumulated
           quiz balance once per 4 hours.</p>
        <div style="display:flex; gap:10px; flex-wrap:wrap;">
          <button id="openQuizBtn" type="button" style="background:linear-gradient(90deg,var(--accent),var(--accent2));color:#000;font-weight:800;border:none;border-radius:12px;padding:10px 14px;box-shadow:0 0 16px rgba(99,179,237,.65),0 0 30px rgba(99,179,237,.25);text-shadow:0 0 6px rgba(255,255,255,.35);">Play Quiz</button>
          <button id="quizClaimBtn" type="button" style="background:rgba(255,255,255,.06);color:#e6eefb;border:1px solid #335aa833;border-radius:12px;padding:10px 14px;box-shadow:0 0 12px rgba(46,105,189,.35);">Claim 0.0 BALBI</button>
        </div>
        <div id="quizRoundInfo" class="claim-timer" style="margin-top:6px;">Rounds this window: 0/3</div>
        <div id="quizClaimTimer" class="claim-timer"></div>
        <div id="quizClaimMsg" class="claim-success" style="display:none;"></div>
        <div id="quizClaimHash" class="claim-hash" style="display:none;"></div>
      </div>

      <p style="margin-top:16px;">
        <a class="links" href="https://dapp.quickswap.exchange/swap/v3/0x3c499c542cEF5E3811e1192ce70d8cC03d5c3359/0x619B0fcDcb30a45091745Fb12C9640237bbF27c5?chainId=137" target="_blank" style="color:#8ec7ff;text-decoration:none;"> Swap on Quickswap </a>
      </p>
    </div>
  </div>
</div>

<div class="faq">
  <h2>Frequently Asked Questions</h2>
  <div class="faq-item">
    <h3>How often can I claim Balbi?</h3>
    <p>You can claim tokens every 4 hours. This ensures fair distribution for all users.</p>
  </div>
  <div class="faq-item">
    <h3>Is this wallet secure?</h3>
    <p>Yes. We do not store any of your data. The connection and signing of transactions happen directly in your browser, via your chosen wallet app.</p>
  </div>
  <div class="faq-item">
    <h3>Are there any fees?</h3>
    <p>The wallet is completely free. You only pay the standard blockchain network fees (gas fees) for transactions.</p>
  </div>
</div>
<div class="footer">
  <div class="links">
    <a href="terms.html">Terms of Service</a>
    <a href="privacy.html">Privacy Policy</a>
    <a href="https://polygonscan.com/token/0x619B0fcDcb30a45091745Fb12C9640237bbF27c5" target="_blank">View Contract</a>
  </div>
  <div>© 2025 Balbi Faucet. Construído com ❤️ para a comunidade cripto.</div>
</div>
<div id="cookieConsent">
  <p>We use cookies to store your private key locally and improve your experience. By continuing, you agree to our Privacy Policy.</p>
  <button id="acceptCookiesButton" type="button">Accept</button>
</div>
<script type="module">
  import { createWeb3Modal, defaultConfig } from 'https://unpkg.com/@web3modal/ethers@5-5.0.0/dist/index.mjs';

  // 1. Defina o ID do projeto
  const projectId = '7794f7fbb6272b20eaae65d8588fe882';

  // 2. Defina os metadados da sua DApp
  const metadata = {
    name: 'Balbi Faucet',
    description: 'Faucet oficial do Balbi Token',
    url: 'https://balbi-token.github.io',
    icons: ['https://balbi-token.github.io/logo1.png']
  };

  // 3. Defina as cadeias suportadas
  const mainnet = {
    chainId: 1,
    name: 'Ethereum',
    currency: 'ETH',
    explorerUrl: 'https://etherscan.io',
    rpcUrl: 'https://rpc.ankr.com/eth'
  };
  const polygon = {
    chainId: 137,
    name: 'Polygon',
    currency: 'MATIC',
    explorerUrl: 'https://polygonscan.com',
    rpcUrl: 'https://rpc.ankr.com/polygon'
  };
  const chains = [mainnet, polygon];

  // 4. Configure o Web3Modal
  const ethersConfig = defaultConfig({
    metadata,
    enableEIP6963: true,
    enableInjected: true,
    enableCoinbase: true,
    rpcUrl: '...',
    defaultChainId: 1
  });

  // 5. Crie o modal
  const web3modal = createWeb3Modal({
    ethersConfig,
    chains,
    projectId
  });

  // 6. Scripts para login e controle da UI
  const backendURL = 'https://balbi-faucet-backend.balbi.repl.co';
  const connectButton = document.getElementById('connectButton');
  const logoutButton = document.getElementById('logoutButton');
  const loginSection = document.getElementById('loginSection');
  const walletAddressEl = document.getElementById('walletAddress');
  const walletInfoEl = document.getElementById('walletInfo');
  const addressDisplay = document.getElementById('addressDisplay');
  const claimButton = document.getElementById('claimButton');
  const claimTimer = document.getElementById('claimTimer');
  const claimSuccess = document.getElementById('claimSuccess');
  const claimHash = document.getElementById('claimHash');
  const balbiBalanceEl = document.getElementById('balbiBalance');
  const usdcBalanceEl = document.getElementById('usdcBalance');
  const quizClaimBtn = document.getElementById('quizClaimBtn');
  const quizClaimMsg = document.getElementById('quizClaimMsg');
  const quizClaimHash = document.getElementById('quizClaimHash');

  async function fetchBalances(walletAddress) {
    try {
      const response = await fetch(`${backendURL}/balance`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ address: walletAddress }),
        mode: 'cors'
      });
      const data = await response.json();
      if (response.ok) {
        balbiBalanceEl.textContent = Number(data.balbi).toFixed(4);
        usdcBalanceEl.textContent = Number(data.usdc).toFixed(2);
      } else {
        console.error('Failed to fetch balances:', data.error);
      }
    } catch (error) {
      console.error('Error fetching balances:', error);
    }
  }

  function updateUI(account, isConnected) {
    if (isConnected && account) {
      loginSection.style.display = 'none';
      walletAddressEl.style.display = 'block';
      walletInfoEl.style.display = 'block';
      addressDisplay.textContent = account;
      fetchBalances(account);
      updateClaimButton();
    } else {
      loginSection.style.display = 'block';
      walletAddressEl.style.display = 'none';
      walletInfoEl.style.display = 'none';
      addressDisplay.textContent = '';
      localStorage.removeItem('lastClaimTime');
    }
  }

  // Lógica de atualização da UI quando a conta muda
  web3modal.subscribeState(state => {
    updateUI(state.selectedAccount, state.isConnected);
  });

  // Event Listeners
  if (connectButton) {
    connectButton.addEventListener('click', () => {
      web3modal.open();
    });
  }

  if (logoutButton) {
    logoutButton.addEventListener('click', async () => {
      web3modal.disconnect();
    });
  }

  async function updateClaimButton() {
    const lastClaimTime = localStorage.getItem('lastClaimTime');
    const fourHours = 4 * 60 * 60 * 1000;
    const now = Date.now();
    
    if (!lastClaimTime || now - lastClaimTime > fourHours) {
        claimButton.disabled = false;
        claimButton.textContent = 'Claim Balbi';
        claimTimer.textContent = 'Ready to claim!';
        claimSuccess.style.display = 'none';
        claimHash.style.display = 'none';
    } else {
        claimButton.disabled = true;
        const timeLeft = fourHours - (now - lastClaimTime);
        startCountdown(timeLeft);
    }
  }

  function startCountdown(duration) {
    let timer = duration;
    let interval = setInterval(() => {
        let hours = Math.floor((timer / (1000 * 60 * 60)) % 24);
        let minutes = Math.floor((timer / (1000 * 60)) % 60);
        let seconds = Math.floor((timer / 1000) % 60);

        claimTimer.textContent = `Next claim in: ${hours}h ${minutes}m ${seconds}s`;

        if (timer <= 0) {
            clearInterval(interval);
            updateClaimButton();
        }
        timer -= 1000;
    }, 1000);
  }

  // Funções de Claim (Faucet e Quiz)
  if (claimButton) {
    claimButton.addEventListener('click', async () => {
        const currentAddress = web3modal.getState().selectedAccount;
        if (!currentAddress) {
            alert('Please connect your wallet first!');
            return;
        }

        claimButton.disabled = true;
        claimButton.textContent = 'Claiming...';
        claimSuccess.style.display = 'none';
        claimHash.style.display = 'none';

        try {
            const response = await fetch(`${backendURL}/claim`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ address: currentAddress }),
                mode: 'cors'
            });
            const data = await response.json();

            if (response.ok) {
                localStorage.setItem('lastClaimTime', Date.now());
                claimSuccess.textContent = 'Tokens sent successfully!';
                claimSuccess.style.display = 'block';
                claimHash.textContent = 'Tx Hash: ' + data.txHash;
                claimHash.style.display = 'block';
                await fetchBalances(currentAddress);
                updateClaimButton();
            } else {
                throw new Error(data.error || 'Claim failed.');
            }
        } catch (error) {
            claimSuccess.textContent = 'Claim failed: ' + error.message;
            claimSuccess.style.display = 'block';
            claimButton.disabled = false;
            claimButton.textContent = 'Claim Balbi';
        }
    });
  }

  async function claimQuizTokens(address) {
    const acc = 0.15; // Placeholder value - replace with logic from your quiz
    try {
        const res = await fetch(`${backendURL}/quiz-claim`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ address, amount: acc }),
            mode: 'cors'
        });
        const data = await res.json().catch(() => ({}));
        if (!res.ok) {
            throw new Error(data && data.error ? data.error : 'quiz-claim rejected');
        }
        quizClaimMsg.textContent = 'Quiz tokens sent successfully!';
        quizClaimMsg.style.display = 'block';
        if (data && data.txHash) {
            quizClaimHash.textContent = 'Tx Hash: ' + data.txHash;
            quizClaimHash.style.display = 'block';
        }
    } catch (e) {
        quizClaimMsg.textContent = 'Quiz claim failed: ' + (e.message || 'unknown error');
        quizClaimMsg.style.display = 'block';
    }
  }

  if (quizClaimBtn) {
    quizClaimBtn.addEventListener('click', () => {
        const currentAddress = web3modal.getState().selectedAccount;
        if (currentAddress) {
            claimQuizTokens(currentAddress);
        }
    });
  }

  // Inicializa a UI
  document.addEventListener('DOMContentLoaded', () => {
    const state = web3modal.getState();
    updateUI(state.selectedAccount, state.isConnected);
  });
</script>

</body>
</html>
